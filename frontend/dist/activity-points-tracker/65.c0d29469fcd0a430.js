"use strict";(self.webpackChunkactivity_points_tracker=self.webpackChunkactivity_points_tracker||[]).push([[65],{3065:(j,l,a)=>{a.r(l),a.d(l,{TeacherDashboardComponent:()=>y});var d=a(177),v=a(2183),r=a(4341),p=a(1529),t=a(4438),m=a(8010),u=a(8489);function h(i,o){1&i&&(t.j41(0,"div",19)(1,"div",20)(2,"span",21),t.EFF(3,"Loading..."),t.k0s()(),t.j41(4,"p",22),t.EFF(5,"Loading your dashboard..."),t.k0s()())}function b(i,o){1&i&&(t.j41(0,"div",36)(1,"p",27),t.EFF(2,"No pending certificate requests."),t.k0s()())}function f(i,o){if(1&i){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"div",40)(3,"span",41),t.EFF(4),t.k0s(),t.j41(5,"small",42),t.EFF(6),t.k0s()()(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td"),t.EFF(12),t.nI1(13,"date"),t.k0s(),t.j41(14,"td")(15,"button",43),t.bIt("click",function(){const n=t.eBV(e).$implicit,c=t.XpG(3);return t.Njj(c.selectActivity(n))}),t.EFF(16," Review "),t.k0s()()()}if(2&i){const e=o.$implicit,s=t.XpG(3);t.R7$(4),t.JRh(s.isUserObject(e.student)?e.student.name:"Unknown"),t.R7$(2),t.Lme("",s.isUserObject(e.student)?e.student.rollNumber:""," | ",s.isUserObject(e.student)?e.student.class:"",""),t.R7$(2),t.JRh(e.title),t.R7$(2),t.JRh(e.activityType),t.R7$(2),t.JRh(t.i5U(13,6,e.date,"mediumDate"))}}function F(i,o){if(1&i&&(t.j41(0,"div",37)(1,"table",38)(2,"thead")(3,"tr")(4,"th"),t.EFF(5,"Student"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Title"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Type"),t.k0s(),t.j41(10,"th"),t.EFF(11,"Date"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Actions"),t.k0s()()(),t.j41(14,"tbody"),t.DNE(15,f,17,9,"tr",39),t.k0s()()()),2&i){const e=t.XpG(2);t.R7$(15),t.Y8G("ngForOf",e.pendingActivities)}}function g(i,o){if(1&i&&(t.j41(0,"div")(1,"div",1)(2,"div",23)(3,"div",24)(4,"div",25)(5,"h3",26),t.EFF(6),t.k0s(),t.j41(7,"p",27),t.EFF(8,"Pending Requests"),t.k0s()()()(),t.j41(9,"div",23)(10,"div",24)(11,"div",25)(12,"h3",28),t.EFF(13),t.k0s(),t.j41(14,"p",27),t.EFF(15,"Approved Requests"),t.k0s()()()(),t.j41(16,"div",29)(17,"div",24)(18,"div",25)(19,"h3",30),t.EFF(20),t.k0s(),t.j41(21,"p",27),t.EFF(22,"Rejected Requests"),t.k0s()()()()(),t.j41(23,"div",31)(24,"div",32)(25,"h5",4),t.EFF(26,"Pending Certificate Requests"),t.k0s()(),t.j41(27,"div",33),t.DNE(28,b,3,0,"div",34)(29,F,16,1,"div",35),t.k0s()()()),2&i){const e=t.XpG();t.R7$(6),t.JRh(e.totalPendingRequests),t.R7$(7),t.JRh(e.totalApprovedRequests),t.R7$(7),t.JRh(e.totalRejectedRequests),t.R7$(8),t.Y8G("ngIf",0===e.pendingActivities.length),t.R7$(),t.Y8G("ngIf",e.pendingActivities.length>0)}}function _(i,o){if(1&i&&(t.j41(0,"div")(1,"a",63),t.nrm(2,"i",64),t.EFF(3,"View Certificate "),t.k0s(),t.j41(4,"small",65),t.EFF(5,"Click to open certificate in a new tab"),t.k0s()()),2&i){const e=t.XpG(2);t.R7$(),t.Y8G("href",e.getCertificateUrl(e.selectedActivity.certificateFile),t.B4B)}}function k(i,o){1&i&&(t.j41(0,"p",42),t.EFF(1,"No certificate available"),t.k0s())}function E(i,o){if(1&i&&(t.j41(0,"div")(1,"div",1)(2,"div",44)(3,"h6",45),t.EFF(4,"Student Information"),t.k0s(),t.j41(5,"p",46)(6,"strong"),t.EFF(7,"Name:"),t.k0s(),t.EFF(8),t.k0s(),t.j41(9,"p",46)(10,"strong"),t.EFF(11,"Roll Number:"),t.k0s(),t.EFF(12),t.k0s(),t.j41(13,"p",46)(14,"strong"),t.EFF(15,"Class:"),t.k0s(),t.EFF(16),t.k0s(),t.j41(17,"p",46)(18,"strong"),t.EFF(19,"Department:"),t.k0s(),t.EFF(20),t.k0s(),t.j41(21,"p",4)(22,"strong"),t.EFF(23,"Semester:"),t.k0s(),t.EFF(24),t.k0s()(),t.j41(25,"div",44)(26,"h6",45),t.EFF(27,"Certificate Information"),t.k0s(),t.j41(28,"p",46)(29,"strong"),t.EFF(30,"Title:"),t.k0s(),t.EFF(31),t.k0s(),t.j41(32,"p",46)(33,"strong"),t.EFF(34,"Type:"),t.k0s(),t.EFF(35),t.k0s(),t.j41(36,"p",46)(37,"strong"),t.EFF(38,"Date:"),t.k0s(),t.EFF(39),t.nI1(40,"date"),t.k0s(),t.j41(41,"p",4)(42,"strong"),t.EFF(43,"Submitted On:"),t.k0s(),t.EFF(44),t.nI1(45,"date"),t.k0s()()(),t.j41(46,"div",47)(47,"h6",45),t.EFF(48,"Description"),t.k0s(),t.j41(49,"p",4),t.EFF(50),t.k0s()(),t.j41(51,"div",47)(52,"h6",45),t.EFF(53,"Certificate Preview"),t.k0s(),t.DNE(54,_,6,1,"div",8)(55,k,2,0,"p",48),t.k0s(),t.j41(56,"form",49)(57,"div",50)(58,"label",51),t.EFF(59,"Decision"),t.k0s(),t.j41(60,"div",52)(61,"div",53),t.nrm(62,"input",54),t.j41(63,"label",55),t.EFF(64," Approve "),t.k0s()(),t.j41(65,"div",56),t.nrm(66,"input",57),t.j41(67,"label",58),t.EFF(68," Reject "),t.k0s()()()(),t.j41(69,"div",50)(70,"label",59),t.EFF(71,"Activity Points"),t.k0s(),t.nrm(72,"input",60),t.j41(73,"small",42),t.EFF(74,"Points calculated based on activity type and level"),t.k0s()(),t.j41(75,"div",50)(76,"label",61),t.EFF(77,"Feedback (Optional)"),t.k0s(),t.nrm(78,"textarea",62),t.k0s()()()),2&i){const e=t.XpG();t.R7$(8),t.SpI(" ",e.isUserObject(e.selectedActivity.student)?e.selectedActivity.student.name:"Unknown",""),t.R7$(4),t.SpI(" ",e.isUserObject(e.selectedActivity.student)?e.selectedActivity.student.rollNumber:"",""),t.R7$(4),t.SpI(" ",e.isUserObject(e.selectedActivity.student)?e.selectedActivity.student.class:"",""),t.R7$(4),t.SpI(" ",e.isUserObject(e.selectedActivity.student)?e.selectedActivity.student.department:"",""),t.R7$(4),t.SpI(" ",e.isUserObject(e.selectedActivity.student)?e.selectedActivity.student.semester:"",""),t.R7$(7),t.SpI(" ",e.selectedActivity.title,""),t.R7$(4),t.SpI(" ",e.selectedActivity.activityType,""),t.R7$(4),t.SpI(" ",t.i5U(40,14,e.selectedActivity.date,"mediumDate"),""),t.R7$(5),t.SpI(" ",t.i5U(45,17,e.selectedActivity.createdAt,"mediumDate"),""),t.R7$(6),t.JRh(e.selectedActivity.description),t.R7$(4),t.Y8G("ngIf",null==e.selectedActivity?null:e.selectedActivity.certificateFile),t.R7$(),t.Y8G("ngIf",!(null!=e.selectedActivity&&e.selectedActivity.certificateFile)),t.R7$(),t.Y8G("formGroup",e.reviewForm),t.R7$(16),t.Y8G("value",e.selectedActivity.points)}}let y=(()=>{class i{constructor(e,s,n){this.authService=e,this.activityService=s,this.fb=n,this.currentUser=null,this.pendingActivities=[],this.isLoading=!0,this.selectedActivity=null,this.totalPendingRequests=0,this.totalApprovedRequests=0,this.totalRejectedRequests=0,this.reviewForm=this.fb.group({status:["approved"],feedback:[""]})}ngOnInit(){this.currentUser=this.authService.getCurrentUser(),this.loadPendingActivities()}isUserObject(e){return"object"==typeof e}getCertificateUrl(e){if(!e)return console.warn("No certificate file path provided"),"";console.log("Original certificate path:",e);let s=e;e.includes("\\")?s=e.split("\\").pop()||"":e.includes("/")&&(s=e.split("/").pop()||"");const n=`http://localhost:5000/uploads/${e}`;return console.log("Final certificate URL:",n),n}loadPendingActivities(){this.isLoading=!0,this.activityService.getPendingActivities().subscribe({next:e=>{e&&e.data?(this.pendingActivities=e.data.map(s=>({...s,points:s.points||this.calculateActivityPoints(s)})),e.stats?(this.totalPendingRequests=e.stats.pending||0,this.totalApprovedRequests=e.stats.approved||0,this.totalRejectedRequests=e.stats.rejected||0):this.calculateStats()):(this.pendingActivities=[],this.calculateStats()),this.isLoading=!1},error:e=>{console.error("Error loading pending activities:",e),this.isLoading=!1,this.pendingActivities=[],this.calculateStats()}})}calculateActivityPoints(e){const s={1:8,2:15,3:25,4:40,5:50};switch(e.activityType){case"sports":return e.level&&s[e.level]||0;case"mooc":return 50;case"workshops":return 6;case"internships":return 20;default:return 0}}calculateStats(){this.totalPendingRequests=this.pendingActivities.length,this.totalApprovedRequests=5,this.totalRejectedRequests=2}selectActivity(e){this.selectedActivity=e,this.reviewForm.patchValue({status:"approved",feedback:""})}submitReview(){if(!this.selectedActivity||!this.reviewForm.valid)return;const e={status:this.reviewForm.get("status")?.value||"pending",pointsAwarded:this.selectedActivity.points,feedback:this.reviewForm.get("feedback")?.value||""};this.activityService.reviewActivity(this.selectedActivity._id,e).subscribe({next:s=>{const n=this.pendingActivities.findIndex(c=>c._id===this.selectedActivity?._id);-1!==n&&this.pendingActivities.splice(n,1),this.calculateStats(),this.selectedActivity=null},error:s=>{console.error("Error submitting review:",s)}})}static{this.\u0275fac=function(s){return new(s||i)(t.rXU(m.u),t.rXU(u.T),t.rXU(r.ok))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-teacher-dashboard"]],standalone:!0,features:[t.aNF],decls:27,vars:3,consts:[[1,"container","py-4"],[1,"row","mb-4"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-0"],["routerLink","report",1,"btn","btn-primary"],[1,"bi","bi-file-text","me-2"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],["id","reviewModal","tabindex","-1","aria-labelledby","reviewModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","reviewModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"col-md-4","mb-3","mb-md-0"],[1,"card","h-100","border-0","shadow-sm"],[1,"card-body","d-flex","flex-column","align-items-center"],[1,"text-warning","mb-0"],[1,"text-muted","mb-0"],[1,"text-success","mb-0"],[1,"col-md-4"],[1,"text-danger","mb-0"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-white","border-0"],[1,"card-body"],["class","text-center py-4",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"text-center","py-4"],[1,"table-responsive"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[1,"d-flex","flex-column"],[1,"fw-medium"],[1,"text-muted"],["data-bs-toggle","modal","data-bs-target","#reviewModal",1,"btn","btn-sm","btn-primary",3,"click"],[1,"col-md-6"],[1,"mb-2"],[1,"mb-1"],[1,"mb-4"],["class","text-muted",4,"ngIf"],[3,"formGroup"],[1,"mb-3"],[1,"form-label"],[1,"d-flex"],[1,"form-check","me-3"],["type","radio","formControlName","status","id","statusApprove","value","approved",1,"form-check-input"],["for","statusApprove",1,"form-check-label"],[1,"form-check"],["type","radio","formControlName","status","id","statusReject","value","rejected",1,"form-check-input"],["for","statusReject",1,"form-check-label"],["for","pointsAwarded",1,"form-label"],["type","number","id","pointsAwarded","readonly","",1,"form-control","bg-light",3,"value"],["for","feedback",1,"form-label"],["id","feedback","formControlName","feedback","rows","3","placeholder","Provide feedback to the student",1,"form-control"],["target","_blank",1,"btn","btn-primary",3,"href"],[1,"bi","bi-file-earmark-pdf","me-2"],[1,"d-block","mt-2","text-muted"]],template:function(s,n){1&s&&(t.nrm(0,"app-navbar"),t.j41(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"h1",4),t.EFF(6,"Teacher Dashboard"),t.k0s(),t.j41(7,"div")(8,"a",5),t.nrm(9,"i",6),t.EFF(10,"View Report "),t.k0s()()()()(),t.DNE(11,h,6,0,"div",7)(12,g,30,5,"div",8),t.k0s(),t.j41(13,"div",9)(14,"div",10)(15,"div",11)(16,"div",12)(17,"h5",13),t.EFF(18,"Review Certificate"),t.k0s(),t.nrm(19,"button",14),t.k0s(),t.j41(20,"div",15),t.DNE(21,E,79,20,"div",8),t.k0s(),t.j41(22,"div",16)(23,"button",17),t.EFF(24,"Close"),t.k0s(),t.j41(25,"button",18),t.bIt("click",function(){return n.submitReview()}),t.EFF(26,"Submit Review"),t.k0s()()()()()),2&s&&(t.R7$(11),t.Y8G("ngIf",n.isLoading),t.R7$(),t.Y8G("ngIf",!n.isLoading),t.R7$(9),t.Y8G("ngIf",n.selectedActivity))},dependencies:[d.MD,d.Sq,d.bT,d.vh,v.Wk,r.X1,r.qT,r.me,r.Fm,r.BC,r.cb,r.j4,r.JD,p._],styles:[".shadow-sm[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013!important}.card[_ngcontent-%COMP%]{transition:transform .2s ease-in-out}.card[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}h3[_ngcontent-%COMP%]{font-size:2rem;font-weight:600}.text-muted[_ngcontent-%COMP%]{font-size:.9rem}.table[_ngcontent-%COMP%]{font-size:.95rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#495057}.card-header[_ngcontent-%COMP%]{padding:1rem 1.25rem}.card-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-weight:600}.fw-medium[_ngcontent-%COMP%]{font-weight:500}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid #ced4da;border-radius:.375rem;font-size:1rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#80bdff;box-shadow:0 0 0 .2rem #007bff40}.certificate-preview[_ngcontent-%COMP%]{border:1px solid #ced4da;border-radius:.375rem;padding:2rem;background-color:#f8f9fa;min-height:200px;display:flex;align-items:center;justify-content:center}"]})}}return i})()}}]);