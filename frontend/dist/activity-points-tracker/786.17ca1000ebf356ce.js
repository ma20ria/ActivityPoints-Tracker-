"use strict";(self.webpackChunkactivity_points_tracker=self.webpackChunkactivity_points_tracker||[]).push([[786],{4786:(X,b,a)=>{a.r(b),a.d(b,{ActivitySubmitComponent:()=>q});var u=a(177),l=a(4341),E=a(2183),S=a(1529),t=a(4438),T=a(8010),C=a(8489);function P(n,r){if(1&n&&(t.j41(0,"div",44),t.EFF(1),t.k0s()),2&n){const i=t.XpG();t.R7$(),t.SpI(" ",i.successMessage," ")}}function M(n,r){if(1&n&&(t.j41(0,"div",45),t.EFF(1),t.k0s()),2&n){const i=t.XpG();t.R7$(),t.SpI(" ",i.errorMessage," ")}}function j(n,r){1&n&&(t.j41(0,"span"),t.EFF(1,"Drag & drop your certificate here or click to browse"),t.k0s())}function A(n,r){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const i=t.XpG();t.R7$(),t.JRh(i.selectedFile.name)}}function O(n,r){1&n&&(t.j41(0,"div",46),t.EFF(1," Title is required "),t.k0s())}function R(n,r){1&n&&(t.j41(0,"div",46),t.EFF(1," Event organizer is required "),t.k0s())}function D(n,r){if(1&n&&(t.j41(0,"option",47),t.EFF(1),t.nI1(2,"titlecase"),t.k0s()),2&n){const i=r.$implicit;t.Y8G("value",i),t.R7$(),t.JRh(t.bMT(2,2,i))}}function I(n,r){1&n&&(t.j41(0,"div",46),t.EFF(1," Activity type is required "),t.k0s())}function $(n,r){1&n&&(t.j41(0,"div",46),t.EFF(1," Valid date is required "),t.k0s())}function G(n,r){if(1&n&&(t.j41(0,"option",47),t.EFF(1),t.k0s()),2&n){const i=r.$implicit;t.Y8G("value",i),t.R7$(),t.SpI("Level ",i,"")}}function N(n,r){1&n&&(t.j41(0,"div",46),t.EFF(1," Level is required for sports activities "),t.k0s())}function U(n,r){if(1&n&&(t.j41(0,"div",23)(1,"label",48),t.EFF(2,"Activity Level"),t.k0s(),t.j41(3,"select",49)(4,"option",31),t.EFF(5,"Select Level"),t.k0s(),t.DNE(6,G,2,2,"option",32),t.k0s(),t.DNE(7,N,2,0,"div",26),t.k0s()),2&n){let i,s;const e=t.XpG();t.R7$(3),t.AVh("is-invalid",(null==(i=e.activityForm.get("level"))?null:i.invalid)&&(null==(i=e.activityForm.get("level"))?null:i.touched)),t.R7$(3),t.Y8G("ngForOf",e.levels),t.R7$(),t.Y8G("ngIf",(null==(s=e.activityForm.get("level"))?null:s.invalid)&&(null==(s=e.activityForm.get("level"))?null:s.touched))}}function Y(n,r){if(1&n&&(t.j41(0,"option",47),t.EFF(1),t.k0s()),2&n){const i=r.$implicit;t.Y8G("value",i),t.R7$(),t.SpI("Semester ",i,"")}}function w(n,r){1&n&&(t.j41(0,"span"),t.EFF(1,"Semester is required"),t.k0s())}function z(n,r){1&n&&(t.j41(0,"span"),t.EFF(1," Semester must be between 1 and 8 "),t.k0s())}function V(n,r){if(1&n&&(t.j41(0,"div",46),t.DNE(1,w,2,0,"span",20)(2,z,2,0,"span",20),t.k0s()),2&n){let i,s;const e=t.XpG();t.R7$(),t.Y8G("ngIf",null==(i=e.activityForm.get("semester"))||null==i.errors?null:i.errors.required),t.R7$(),t.Y8G("ngIf",(null==(s=e.activityForm.get("semester"))||null==s.errors?null:s.errors.min)||(null==(s=e.activityForm.get("semester"))||null==s.errors?null:s.errors.max))}}function L(n,r){1&n&&(t.j41(0,"div",46),t.EFF(1," Description is required "),t.k0s())}function x(n,r){1&n&&(t.j41(0,"span"),t.nrm(1,"i",50),t.EFF(2,"Submitting... "),t.k0s())}function B(n,r){1&n&&(t.j41(0,"span"),t.EFF(1,"Submit Activity"),t.k0s())}let q=(()=>{class n{constructor(i,s,e,o){this.fb=i,this.authService=s,this.activityService=e,this.router=o,this.currentUser=null,this.isLoading=!1,this.isSubmitting=!1,this.errorMessage="",this.successMessage="",this.selectedFile=null,this.calculatedPoints=0,this.today=(new Date).toISOString().split("T")[0],this.activityTypes=["sports","mooc","workshops","internships"],this.levels=[1,2,3,4,5],this.semesters=[1,2,3,4,5,6,7,8],this.sportsPointsMap={1:8,2:15,3:25,4:40,5:50},this.activityForm=this.fb.group({title:["",[l.k0.required]],activityType:["",[l.k0.required]],description:["",[l.k0.required]],eventOrganizer:["",[l.k0.required]],date:["",[l.k0.required]],level:[""],points:[0],semester:["",[l.k0.required,l.k0.min(1),l.k0.max(8)]]}),this.activityForm.get("activityType")?.valueChanges.subscribe(()=>{this.calculatePoints(),this.updateLevelValidation()}),this.activityForm.get("level")?.valueChanges.subscribe(()=>{this.calculatePoints()})}ngOnInit(){this.currentUser=this.authService.getCurrentUser(),this.currentUser||this.router.navigate(["/login"])}updateLevelValidation(){const i=this.activityForm.get("activityType")?.value,s=this.activityForm.get("level");"sports"===i?s?.setValidators([l.k0.required,l.k0.min(1),l.k0.max(5)]):s?.clearValidators(),s?.updateValueAndValidity()}calculatePoints(){const i=this.activityForm.get("activityType")?.value,s=Number(this.activityForm.get("level")?.value);if(i){switch(i){case"sports":this.calculatedPoints=this.sportsPointsMap[s]||0;break;case"mooc":this.calculatedPoints=50;break;case"workshops":this.calculatedPoints=6;break;case"internships":this.calculatedPoints=20;break;default:this.calculatedPoints=0}this.activityForm.patchValue({points:this.calculatedPoints},{emitEvent:!1})}else this.calculatedPoints=0}onFileSelected(i){const s=i.target.files[0];if(s){if(s.size>5242880)return this.errorMessage="File size exceeds 5MB limit",i.target.value="",void(this.selectedFile=null);if(!["application/pdf","image/jpeg","image/jpg","image/png"].includes(s.type))return this.errorMessage="Invalid file type. Please upload PDF, JPG, JPEG, or PNG files only",i.target.value="",void(this.selectedFile=null);this.selectedFile=s,this.errorMessage=""}}onSubmit(){if(this.activityForm.invalid)return this.errorMessage="Please fill in all required fields correctly.",void Object.keys(this.activityForm.controls).forEach(e=>{const o=this.activityForm.get(e);o?.invalid&&o.markAsTouched()});if(!this.selectedFile)return void(this.errorMessage="Please upload a certificate.");this.isSubmitting=!0,this.errorMessage="",this.successMessage="";const i=new FormData;console.log("File being uploaded:",this.selectedFile),i.append("certificate",this.selectedFile,this.selectedFile.name);const s=this.activityForm.value;if(console.log("Form values:",s),i.append("activityType",s.activityType),i.append("title",s.title.trim()),i.append("description",s.description.trim()),i.append("eventOrganizer",(s.eventOrganizer||"Not specified").trim()),i.append("date",new Date(s.date).toISOString()),i.append("semester",s.semester.toString()),i.append("points",this.calculatedPoints.toString()),"sports"===s.activityType&&s.level&&i.append("level",s.level.toString()),!(this.currentUser&&this.currentUser._id&&this.currentUser.name&&this.currentUser.class&&this.currentUser.department))return console.error("Missing required user information"),this.errorMessage="Missing user information. Please log in again.",void(this.isSubmitting=!1);i.append("studentId",this.currentUser._id),i.append("studentName",this.currentUser.name),i.append("studentClass",this.currentUser.class),i.append("studentDepartment",this.currentUser.department),console.log("FormData entries:"),i.forEach((e,o)=>{console.log(o,":",e)}),this.activityService.submitActivity(i).subscribe({next:e=>{console.log("Submission successful:",e),this.isSubmitting=!1,this.successMessage=e.message||"Activity submitted successfully! Your certificate will be reviewed by your teacher.",this.activityForm.reset(),this.selectedFile=null;const o=document.getElementById("certificateFile");o&&(o.value=""),this.activityForm.patchValue({activityType:"",level:"",points:0}),this.calculatedPoints=0,setTimeout(()=>{this.router.navigate(["/activities"])},2e3)},error:e=>{console.error("Submission error:",e),this.isSubmitting=!1,this.errorMessage=e.error&&e.error.message?e.error.message:0===e.status?"Unable to connect to the server. Please check your internet connection.":413===e.status?"File size is too large. Please upload a smaller file.":500===e.status?"Server error. Please try again later or contact support.":"Failed to submit activity. Please try again.",console.error("Error details:",{status:e.status,statusText:e.statusText,error:e.error,message:e.message})}})}static{this.\u0275fac=function(s){return new(s||n)(t.rXU(l.ok),t.rXU(T.u),t.rXU(C.T),t.rXU(E.Ix))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-activity-submit"]],standalone:!0,features:[t.aNF],decls:78,vars:33,consts:[[1,"container","py-4"],[1,"row","mb-4"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-0"],["routerLink","/dashboard/student",1,"btn","btn-outline-primary"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-4"],["class","alert alert-success mb-4",4,"ngIf"],["class","alert alert-danger mb-4",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"mb-3"],[1,"certificate-upload-container"],[1,"certificate-upload-box"],["type","file","id","certificateFile","accept",".pdf,.jpg,.jpeg,.png",1,"file-input",3,"change"],["for","certificateFile",1,"file-label"],[1,"upload-icon"],[1,"bi","bi-cloud-arrow-up"],[1,"upload-text"],[4,"ngIf"],[1,"text-muted"],[1,"row"],[1,"col-md-6","mb-3"],["for","title",1,"form-label"],["type","text","id","title","formControlName","title",1,"form-input"],["class","invalid-feedback",4,"ngIf"],["for","eventOrganizer",1,"form-label"],["type","text","id","eventOrganizer","formControlName","eventOrganizer",1,"form-input"],["for","activityType",1,"form-label"],["id","activityType","formControlName","activityType",1,"form-input"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","date",1,"form-label"],["type","date","id","date","formControlName","date",1,"form-input",3,"max"],["class","col-md-6 mb-3",4,"ngIf"],["for","semester",1,"form-label"],["id","semester","formControlName","semester",1,"form-input"],[1,"form-label"],[1,"form-control","bg-light"],["for","description",1,"form-label"],["id","description","formControlName","description","rows","4",1,"form-input"],[1,"d-grid","gap-2","mt-4"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"alert","alert-success","mb-4"],[1,"alert","alert-danger","mb-4"],[1,"invalid-feedback"],[3,"value"],["for","level",1,"form-label"],["id","level","formControlName","level",1,"form-input"],[1,"bi","bi-arrow-repeat","spin","me-2"]],template:function(s,e){if(1&s&&(t.nrm(0,"app-navbar"),t.j41(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"h1",4),t.EFF(6,"Submit Activity"),t.k0s(),t.j41(7,"a",5),t.EFF(8,"Back to Dashboard"),t.k0s()()()(),t.j41(9,"div",6)(10,"div",7),t.DNE(11,P,2,1,"div",8)(12,M,2,1,"div",9),t.j41(13,"form",10),t.bIt("ngSubmit",function(){return e.onSubmit()}),t.j41(14,"div",11)(15,"h5",12),t.EFF(16,"Upload Certificate"),t.k0s(),t.j41(17,"div",13)(18,"div",14)(19,"input",15),t.bIt("change",function(c){return e.onFileSelected(c)}),t.k0s(),t.j41(20,"label",16)(21,"div",17),t.nrm(22,"i",18),t.k0s(),t.j41(23,"div",19),t.DNE(24,j,2,0,"span",20)(25,A,2,1,"span",20),t.k0s()()()(),t.j41(26,"small",21),t.EFF(27,"Supported formats: PDF, JPG, JPEG, PNG (Max size: 5MB)"),t.k0s()(),t.j41(28,"div",22)(29,"div",23)(30,"label",24),t.EFF(31,"Certificate Title"),t.k0s(),t.nrm(32,"input",25),t.DNE(33,O,2,0,"div",26),t.k0s(),t.j41(34,"div",23)(35,"label",27),t.EFF(36,"Event Organizer"),t.k0s(),t.nrm(37,"input",28),t.DNE(38,R,2,0,"div",26),t.k0s()(),t.j41(39,"div",22)(40,"div",23)(41,"label",29),t.EFF(42,"Activity Type"),t.k0s(),t.j41(43,"select",30)(44,"option",31),t.EFF(45,"Select Activity Type"),t.k0s(),t.DNE(46,D,3,4,"option",32),t.k0s(),t.DNE(47,I,2,0,"div",26),t.k0s(),t.j41(48,"div",23)(49,"label",33),t.EFF(50,"Certificate Date"),t.k0s(),t.nrm(51,"input",34),t.DNE(52,$,2,0,"div",26),t.k0s()(),t.j41(53,"div",22),t.DNE(54,U,8,4,"div",35),t.j41(55,"div",23)(56,"label",36),t.EFF(57,"Semester"),t.k0s(),t.j41(58,"select",37)(59,"option",31),t.EFF(60,"Select Semester"),t.k0s(),t.DNE(61,Y,2,2,"option",32),t.k0s(),t.DNE(62,V,3,2,"div",26),t.k0s()(),t.j41(63,"div",22)(64,"div",23)(65,"label",38),t.EFF(66,"Points"),t.k0s(),t.j41(67,"div",39),t.EFF(68),t.k0s()()(),t.j41(69,"div",12)(70,"label",40),t.EFF(71,"Description"),t.k0s(),t.nrm(72,"textarea",41),t.DNE(73,L,2,0,"div",26),t.k0s(),t.j41(74,"div",42)(75,"button",43),t.DNE(76,x,3,0,"span",20)(77,B,2,0,"span",20),t.k0s()()()()()()),2&s){let o,c,m,d,p,v,f,g,k,y,_,h,F;t.R7$(11),t.Y8G("ngIf",e.successMessage),t.R7$(),t.Y8G("ngIf",e.errorMessage),t.R7$(),t.Y8G("formGroup",e.activityForm),t.R7$(5),t.AVh("is-invalid",!e.selectedFile&&e.activityForm.touched),t.R7$(6),t.Y8G("ngIf",!e.selectedFile),t.R7$(),t.Y8G("ngIf",e.selectedFile),t.R7$(7),t.AVh("is-invalid",(null==(o=e.activityForm.get("title"))?null:o.invalid)&&(null==(o=e.activityForm.get("title"))?null:o.touched)),t.R7$(),t.Y8G("ngIf",(null==(c=e.activityForm.get("title"))?null:c.invalid)&&(null==(c=e.activityForm.get("title"))?null:c.touched)),t.R7$(4),t.AVh("is-invalid",(null==(m=e.activityForm.get("eventOrganizer"))?null:m.invalid)&&(null==(m=e.activityForm.get("eventOrganizer"))?null:m.touched)),t.R7$(),t.Y8G("ngIf",(null==(d=e.activityForm.get("eventOrganizer"))?null:d.invalid)&&(null==(d=e.activityForm.get("eventOrganizer"))?null:d.touched)),t.R7$(5),t.AVh("is-invalid",(null==(p=e.activityForm.get("activityType"))?null:p.invalid)&&(null==(p=e.activityForm.get("activityType"))?null:p.touched)),t.R7$(3),t.Y8G("ngForOf",e.activityTypes),t.R7$(),t.Y8G("ngIf",(null==(v=e.activityForm.get("activityType"))?null:v.invalid)&&(null==(v=e.activityForm.get("activityType"))?null:v.touched)),t.R7$(4),t.AVh("is-invalid",(null==(f=e.activityForm.get("date"))?null:f.invalid)&&(null==(f=e.activityForm.get("date"))?null:f.touched)),t.Y8G("max",e.today),t.R7$(),t.Y8G("ngIf",(null==(g=e.activityForm.get("date"))?null:g.invalid)&&(null==(g=e.activityForm.get("date"))?null:g.touched)),t.R7$(2),t.Y8G("ngIf","sports"===(null==(k=e.activityForm.get("activityType"))?null:k.value)),t.R7$(4),t.AVh("is-invalid",(null==(y=e.activityForm.get("semester"))?null:y.invalid)&&(null==(y=e.activityForm.get("semester"))?null:y.touched)),t.R7$(3),t.Y8G("ngForOf",e.semesters),t.R7$(),t.Y8G("ngIf",(null==(_=e.activityForm.get("semester"))?null:_.invalid)&&(null==(_=e.activityForm.get("semester"))?null:_.touched)),t.R7$(6),t.SpI(" ",e.calculatedPoints," points "),t.R7$(4),t.AVh("is-invalid",(null==(h=e.activityForm.get("description"))?null:h.invalid)&&(null==(h=e.activityForm.get("description"))?null:h.touched)),t.R7$(),t.Y8G("ngIf",(null==(F=e.activityForm.get("description"))?null:F.invalid)&&(null==(F=e.activityForm.get("description"))?null:F.touched)),t.R7$(2),t.Y8G("disabled",e.activityForm.invalid||e.isSubmitting||!e.selectedFile),t.R7$(),t.Y8G("ngIf",e.isSubmitting),t.R7$(),t.Y8G("ngIf",!e.isSubmitting)}},dependencies:[u.MD,u.Sq,u.bT,u.PV,l.X1,l.qT,l.xH,l.y7,l.me,l.wz,l.BC,l.cb,l.j4,l.JD,E.Wk,S._],styles:[".shadow-sm[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013!important}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid #ced4da;border-radius:.375rem;font-size:1rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#80bdff;box-shadow:0 0 0 .2rem #007bff40}.form-input.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.text-danger[_ngcontent-%COMP%]{color:#dc3545}.certificate-upload-container[_ngcontent-%COMP%]{width:100%;margin-bottom:1rem}.certificate-upload-box[_ngcontent-%COMP%]{position:relative;width:100%;min-height:150px;border:2px dashed #ced4da;border-radius:.5rem;display:flex;justify-content:center;align-items:center;overflow:hidden;transition:border-color .3s ease}.certificate-upload-box[_ngcontent-%COMP%]:hover{border-color:#80bdff}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer;z-index:2}.file-label[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;padding:2rem;cursor:pointer}.upload-icon[_ngcontent-%COMP%]{font-size:2.5rem;color:#6c757d;margin-bottom:1rem}.upload-text[_ngcontent-%COMP%]{text-align:center;color:#6c757d}textarea.form-input[_ngcontent-%COMP%]{resize:vertical;min-height:100px}"]})}}return n})()}}]);